language: java

jdk:
    - oraclejdk7

before_install:
    # install necessary x32-libs for Android SDK
    - sudo apt-get update
    - sudo apt-get install -u lib32stdc++6 lib32z1

    # download and extract Android SDK
    - java -version
    - javac -version
    - wget http://dl.google.com/android/android-sdk_r24.0.2-linux.tgz
    - tar xzf android-sdk_r24.0.2-linux.tgz
    - export ANDROID_HOME=`pwd`/android-sdk-linux
    - export PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools

install:
    - echo "y" | android update sdk -a --filter platform-tools,tools,build-tools-21.1.2,extra-android-m2repository,extra-google-m2repository,android-21,extra-google-google_play_services,sys-img-armeabi-v7a-android-21 --no-ui --force

before_script:
    - mkdir -p shippable/testresults

    # create and start emulator
    - android list targets
    - echo no | android create avd --force -n testAvd -t android-21 --abi armeabi-v7a --skin WSVGA
    - emulator -avd testAvd -no-audio -no-window -scale 1 &
    - ./android-wait-for-emulator

script:
    - ./gradlew build connectedCheck

after_script:
    - cp -r build/test-results/* shippable/testresults/

after_success:
    - echo "SUCCESS"

after_failure:
    - echo "FAILURE"