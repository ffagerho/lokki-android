language: java

jdk:
    - oraclejdk7

before_install:
    - sudo apt-get update
    - sudo apt-get install -u lib32stdc++6 lib32z1
    - echo "BEFORE_INSTALL"

install:
    # download and extract Android SDK
    - java -version
    - javac -version
    - wget http://dl.google.com/android/android-sdk_r24.0.2-linux.tgz
    - tar xzf android-sdk_r24.0.2-linux.tgz
    - export ANDROID_HOME=`pwd`/android-sdk-linux
    - export PATH=${PATH}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools
    - echo "y" | android update sdk -a --filter platform-tools,tools,build-tools-21.1.2,extra-android-m2repository,extra-google-m2repository,android-21,extra-google-google_play_services,sys-img-armeabi-v7a-android-21,sys-img-x86-android-21 --no-ui --force

before_script:
    - mkdir -p shippable/testresults

    - uname -a
    - echo ${PATH}
    - ls -la android-sdk-linux/
    - ls -la android-sdk-linux/tools/
    - ls -la /home/shippable/workspace/src/github.com/ffagerho/lokki-android/android-sdk-linux/tools/emulator
    - file /home/shippable/workspace/src/github.com/ffagerho/lokki-android/android-sdk-linux/tools/emulator

    # create and start emulator
    - export ADB_INSTALL_TIMEOUT=10
    - android list targets
    - echo no | android create avd --force -n testAvd -t android-21 --abi armeabi-v7a
    - emulator64-arm -avd testAvd -no-audio -no-window -no-boot-anim -scale 1 &
    - ps fuwax
    - sleep 5
    - adb devices
    - ./android-wait-for-emulator
    - adb shell input keyevent 82

script:
    - ./gradlew build connectedCheck

after_script:
    - cp -r build/test-results/* shippable/testresults/

after_success:
    - echo "SUCCESS"

after_failure:
    - echo "FAILURE"
